!function(){var e=window._=Util={};e.create=function(t,i){function n(){}return n.prototype=t,e.extend(new n,{parent:t},i)},e.extend=function(e){for(var t=1,i=arguments.length;i>t;t++)for(var n in arguments[t])e[n]=arguments[t][n];return e},e.ob=function(){var t={};return t.extend=function(){return _.create(this)},t.create=function(e){return _.create(this).init(e)},t.init=function(){return this},t.soup=function(e){this.parent[e].apply(this,Array.prototype.slice.call(arguments,1))},t.bound=function(t){return e.bind(this[t],this)},t}(),e.bind=function(e,t){return function(){e.apply(t,arguments)}},e.defer=function(e,t){t=t||0,setTimeout(e,t)},e.debounce=function(e,t){function i(t){e.apply(n,t)}var n,o=0;return function(){o&&clearTimeout(o),n=this,o=setTimeout(i,t,arguments)}},e.throttle=function(t,i){function n(){l=e.now(),o=0,s=t.apply(r,a)}var o,s,a,r,l=0;return function(){var c=e.now(),u=i-c+l;return a=arguments,r=this,1>u?(clearTimeout(o),o=0,l=c,s=t.apply(r,a)):o||(o=setTimeout(n,u)),s}},e.now=function(){return new Date-0},e.powerOf2=function(e){return e>0&&e-1&0===e},e.max=function(e,t){return e>t?e:t},e.min=function(e,t){return t>e?e:t},e.limit=function(e,t,i){return t>e?t:e>i?i:e},e.stamp=function(e,t){var i=e;for(var n in t)i=i.replace(new RegExp(n,"g"),t[n]);return i},e.last=function(e){return e[e.length-1]},e.each=function(e,t){if(e.length===+e.length)Array.prototype.forEach.call(e,t);else for(var i in e)e.hasOwnProperty(i)&&t(e[i],i)},e.toKeys=function(e,t){var i={};return t=t||function(){return null},Array.prototype.forEach.call(e,function(e){i[e]=t(e)}),i},e.search=function(e,t){var i=-1;return _.each(e,function(e,n){t(e)&&(i=n)}),i},e.weed=function(e,t){var i=[];return _.each(e,function(e){t(e)||newArry.push(e)}),i},e.toArray=function(e){var t=[];for(var i in e)t.push(e[i]);return t},e.text=function(e){for(var t="",i=e.childNodes,n=0,o=i.length;o>n;n++)i[n].nodeType===e.TEXT_NODE&&(t+=i[n].textContent);return t}}(),function(){var e=this,t=(e.window,e.document);"undefined"==typeof require&&(require=function(e,t,i){setTimeout(i,0)});var i=e.Melodicism={};i.init=function(){var e=t.getElementById("canvas");i.Controller.init(),i.Canvas.init(e),i.Audio.init(),i.Nodes.init(),i.Sounds.init(),i.Sounds.onload(i.start),i.Sounds.load(),i.Message.init(),i.puzzles=[],i.loadPuzzle(0)},i.start=function(){i.Canvas.start(),i.Audio.start()},i.loadPuzzle=function(e){var t=i.Puzzle.Config[e];require("puzzles/"+t,!0,function(){i.puzzle=i.Puzzle.Puzzles[t].create(),i.puzzle.level=e})},i.loadNextPuzzle=function(){i.loadPuzzle(i.puzzle.level+1)},require(["Util","eventer","controller","canvas","audio","node","sampler_node","bounce_node","drone_node","nodes","sounds","message","puzzle"],!0,i.init)}(),function(){var e=this,t=e.Eventer=_.ob.extend();t.init=function(){this.events={}},t.on=function(e,t,i){this.events[e]||(this.events[e]=[]),this.events[e].push({callback:t,context:i})},t.off=function(e,t){var i=this.events[e];i&&(i=_.weed(i,function(e){return e.callback===t}),this.events[e]=i)},t.fire=function(t){var i,n=this.events[t];if(n)for(var o=0,s=n.length;s>o;o++)i=n[o].context||e,n[o].callback.apply(i,Array.prototype.slice.call(arguments,1))}}.call(Melodicism),function(){function e(e){l.fire(f[e.which],"down")&&e.preventDefault()}function t(e){l.fire(f[e.which],"up")&&e.preventDefault()}function i(e){e.pageX&&(e.x=e.pageX,e.y=e.pageY)}function n(e){i(e),l.fire("touch","down",e)&&e.preventDefault(),d=!0}function o(e){i(e),l.fire("touch","up",e)&&e.preventDefault(),d=!1}function s(e){i(e),d&&l.fire("move","down",e)?e.preventDefault():l.fire("move","up",e)&&e.preventDefault()}function a(e){"pause"===this.className?(this.className="play",l.fire("touch","pause",e)):(this.className="pause",l.fire("touch","play",e)),e.stopPropagation()}var r=this,l=r.Melodicism.Controller=_.ob.extend(),c=r.document,u=["pauseplay","touch","move"],h={},d=!1,f={37:"left",38:"up",39:"right",40:"down",32:"pauseplay",16:"enter"};l.fire=function(e,t,i){var n=h[e];if(n){for(var o=n[t],s=0,a=o.length;a>s;s++)o[s](i);return!0}},l.listen=function(e,t,i){h[e][t].indexOf(i)<0&&h[e][t].push(i)},l.forget=function(e,t,i){var n=h[e][t].indexOf(i);n>=0&&h[e][t].splice(n,1)},l.setPlayButtonState=function(e){c.getElementById("pauseplay").className=e},l.init=function(){u.forEach(function(e){h[e]={down:[],up:[],pause:[],play:[]}}),c.body.addEventListener("keydown",e),c.body.addEventListener("keyup",t),"ontouchstart"in c.documentElement?(c.body.addEventListener("touchstart",n),c.body.addEventListener("touchmove",s),c.body.addEventListener("touchend",o),c.getElementById("pauseplay").addEventListener("touchstart",a)):(c.body.addEventListener("mousedown",n),c.body.addEventListener("mousemove",s),c.body.addEventListener("mouseup",o),c.getElementById("pauseplay").addEventListener("mousedown",a))}}(),function(){var e,t,i,n,o,s=this,a=s.Melodicism.Canvas={},r=0,l=!1,c={};a.init=function(i){a.canvas=n=i,a.ctx=o=i.getContext("2d"),a.resize(),window.addEventListener("resize",_.debounce(a.resize,100)),s.Melodicism.Controller.listen("pauseplay","down",a.pausePlay),e=s.Melodicism.Audio,t=s.Melodicism.Nodes.nodes,r=_.now()/1e3};var u=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,20)};a.resize=function(){a.size={height:window.innerHeight,width:window.innerWidth},a.center={x:a.size.width/2,y:a.size.height/2},_.extend(n,a.size)},a.draw=function(){var c,h,d=e.ctx.currentTime,f=0,p=50;if(t=s.Melodicism.Nodes.nodes,i=s.Melodicism.puzzle,o.clearRect(0,0,1e8,1e8),o.save(),i)if(i.solved()){var m=_.now()-i.solvedAt;f=-_.limit(m-1e3,0,1e3)}else{var v=_.now()-i.bornAt;f=_.limit(1e3-v,0,1e3)}if(i){var g;o.save(),o.shadowBlur=0,o.translate(f,0);for(var b=0,y=i.highlights.length;y>b;b++)g=i.highlights[b],o.fillStyle=a.rgbOb(g.color),o.fillRect(g.x,g.y,g.w,g.h);o.restore()}o.save(),o.shadowBlur=0,o.strokeStyle="rgb(100, 100, 100)",o.lineWidth=.6,p=(p+parseInt(f/2,10))%p;for(var w=50;w<n.height;w+=50)o.beginPath(),o.moveTo(0,w),o.lineTo(n.width,w),o.stroke(),o.closePath();for(var w=p;w<n.width;w+=50)o.beginPath(),o.moveTo(w,0),o.lineTo(w,n.height),o.stroke(),o.closePath();o.restore(),o.save(),o.translate(f,0);for(var b=0,y=t.length;y>b;b++)c=t[b],o.shadowColor=a.rgbOb(c.color),o.shadowBlur=50*c.waveGain(d),h=Math.floor(255*c.waveGain(d)),o.save(),"rippler"===c.waveType?(o.beginPath(),o.globalAlpha=c.waveGain(d),o.arc(c.pulseLocation.x,c.pulseLocation.y,c.waveDistance(d),0,2*Math.PI),o.strokeStyle=a.rgbOb(c.waveColor()),o.lineWidth=1,o.stroke()):"area"===c.waveType&&(o.globalAlpha=c.waveGain(d),o.translate(c.location.x,c.location.y),o.fillStyle=a.radialGradient(c.waveColor(),c.getRadius(),c.waveDistance(d)),o.beginPath(),o.arc(0,0,c.waveDistance(d),0,2*Math.PI),o.fill()),o.restore(),o.beginPath(),o.arc(c.location.x,c.location.y,c.getRadius(),0,2*Math.PI),o.fillStyle=a.rgbOb(c.currentColor()),o.fill();o.restore(),o.restore(),r=d,l&&u(a.draw,n)},a.start=function(){l=!0,a.draw()},a.stop=function(){l=!1},a.pausePlay=function(){l?a.stop():a.start()},a.rgb=function(e,t,i){return"rgb("+e+","+t+","+i+")"},a.rgba=function(e,t,i,n){return"rgba("+e+","+t+","+i+","+n+")"},a.rgbOb=function(e){return a.rgb(e.r,e.g,e.b)},a.rgbaOb=function(e){return a.rgba(e.r,e.g,e.b,e.a)},a.radialGradient=function(e,t,i){var n=a.rgbOb(e),s=n+i,r=c[s];return r||(r=o.createRadialGradient(0,0,t,0,0,i),r.addColorStop(0,n),r.addColorStop(1,a.rgbaOb(_.extend(e,{a:0}))),c[s]=r),r}}(),function(){var e,t=this,i=t.Melodicism.Audio={},n=null,o=0;i.init=function(){i.ctx=new webkitAudioContext,i.fixForOldVersions(),i.masterGain=i.ctx.createGain(),i.masterGain.gain.setValueAtTime(1,i.ctx.currentTime),i.masterGain.connect(i.ctx.destination),i.master=i.ctx.createDynamicsCompressor(),i.master.connect(i.masterGain),t.Melodicism.Controller.listen("pauseplay","down",i.pausePlay),t.Melodicism.Controller.listen("touch","down",i.enableAudio)},i.enableAudio=function(){var e=i.createOscillator();e.noteOn&&(e.connect(i.ctx.destination),e.noteOn(0),e.noteOff(0)),_.defer(function(){t.Melodicism.Controller.forget("touch","down",i.enableAudio)})},i.tick=function(){var n=i.ctx.currentTime;e=t.Melodicism.Nodes.nodes;for(var o=0,s=e.length;s>o;o++)e[o].tick(n)},i.start=function(){o=_.now(),n=setInterval(i.tick,10),i.masterGain.gain.linearRampToValueAtTime(.6,i.ctx.currentTime+.2)},i.stop=function(){clearInterval(n),n=null,i.masterGain.gain.linearRampToValueAtTime(0,i.ctx.currentTime+.2)},i.soundNodes=function(){i.masterGain.gain.linearRampToValueAtTime(.6,i.ctx.currentTime+.2)},i.silenceNodes=function(){i.masterGain.gain.linearRampToValueAtTime(0,i.ctx.currentTime+.2)},i.pausePlay=function(){n?i.stop():i.start()},i.fixForOldVersions=function(){i.ctx.createGain=i.ctx.createGain||i.ctx.createGainNode,i.ctx.createDelay=i.ctx.createDelay||i.ctx.createDelayNode},i.createOscillator=function(){var e=i.ctx.createOscillator();return e}}(),function(){var e,t=this,i=t.Melodicism.Node=t.Melodicism.Eventer.extend();i.color={r:100,g:255,b:100},i.lowColor={r:0,g:155,b:0},i.extend=function(){return _.create(this)},i.create=function(e){return _.create(this).init(e)},i.init=function(i){var n=this;return t.Melodicism.Eventer.init.call(this),this.Audio=e=t.Melodicism.Audio,this.siblings=t.Melodicism.Nodes.nodes,this.waveType="rippler",this.AN={},this.location={x:100,y:100},this.pulseLocation=this.location,this.radius=10,this.waveRadius=200,this.envelope=[[1,.01],[.1,.5],[0,1.5]],this.period=2,this.periodRange=[1,4],this.periodSteps=[1,2,4],this.startTime=0,this.curentTime=0,this.ct=0,this.nextTime=0,this.frequency=196,this.gainer=this.AN.gainer=e.ctx.createGain(),this.gainer.connect(e.master),this.active=!0,i.beatSteps&&i.beatSeconds&&(this.periodSteps=[],_.each(i.beatSteps,function(e,t){n.periodSteps[t]=e*i.beatSeconds})),_.extend(this,i)},i.destroy=function(){this.stop(),_.each(this.AN,function(e){e.disconnect()})},i.start=function(t){t=t||0,this.startTime=e.ctx.currentTime+t,this.nextTime=this.startTime,this.updateLocation(),this.pulse(this.startTime)},i.stop=function(){var t=e.ctx.currentTime+.1;this.gainer.gain.linearRampToValueAtTime(0,t),this.gainer.gain.cancelScheduledValues(t+.001)},i.updateLocation=function(){this.pulseLocation=this.location,this.oscillator.frequency.value=this.frequency*Math.pow(2,this.location.y/700)},i.tick=function(e){this.active&&Math.abs(e-this.currentTime)<.01&&this.updateLocation(),this.active&&e>=this.currentTime&&(this.nextTime=this.currentTime+this.period,this.pulse(this.nextTime))},i.pulse=function(t){this.gainer.gain.setValueAtTime(0,t);for(var i=0,n=this.envelope.length;n>i;i++)this.gainer.gain.linearRampToValueAtTime(this.envelope[i][0],t+this.envelope[i][1]);this.oscillator=this.AN.oscillator=e.createOscillator(),this.oscillator.frequency.value=this.frequency*Math.pow(2,this.location.y/700),this.oscillator.connect(this.gainer),this.oscillator.start(t),this.oscillator.stop(t+this.envelope[i-1][1]),this.currentTime=t,this.fire("pulse")},i.timeSincePulse=function(e){var t,i;return t=e>this.currentTime?this.currentTime:this.currentTime-this.period,i=e-t},i.waveDistance=function(e){return Math.floor(this.waveRadius*this.timeSincePulse(e)/this.period+this.radius)},i.waveGain=function(e){return e&&(this.ct=e),this.gainer.gain.value},i.contains=function(e){var t=Math.sqrt(Math.pow(this.location.x-e.x,2)+Math.pow(this.location.y-e.y,2));return t<this.radius},i.affects=function(e,t){if(e.active&&this.waveGain()>.2){var i=Math.sqrt(Math.pow(this.location.x-e.location.x,2)+Math.pow(this.location.y-e.location.y,2)),n=this.waveDistance(t);return i-e.radius<n&&i+e.radius>n}return!1},i.currentColor=function(){var e=this.waveGain();return{r:Math.floor(e*(this.color.r-this.lowColor.r)+this.lowColor.r),g:Math.floor(e*(this.color.g-this.lowColor.g)+this.lowColor.g),b:Math.floor(e*(this.color.b-this.lowColor.b)+this.lowColor.b)}},i.waveColor=function(){var e=this.waveGain();return{r:Math.floor(e*this.color.r),g:Math.floor(e*this.color.g),b:Math.floor(e*this.color.b)}},i.getRadius=function(){return this.active?this.radius:1.2*this.radius},i.startDrag=function(){this.active=!1,this.stop()},i.endDrag=function(){this.active=!0,this.start()}}(),function(){var e,t,i,n=this,o=n.Melodicism.Node,s=n.Melodicism.SamplerNode=o.extend();s.init=function(s){var a=this;return o.init.call(this,s),this.soup=o,e=this.Audio,t=n.Melodicism.Canvas,i=n.Melodicism.Sounds,this.srces="string"==typeof s.src?[s.src]:s.src,this.onload=s.onload||function(){},this.loaded=!1,this.buffers={},this.bufferArray=[],n.Melodicism.Sounds.onload(function(){a.load()}),this},s.load=function(){var e=this;_.each(e.srces,function(t){e.buffers[t]=i.bufferFor(t)}),e.bufferArray=_.toArray(e.buffers),e.buffer=e.bufferArray[0],e.loaded=!0},s.pulse=function(t){return this.currentTime=t,this.loaded?(this.gainer.gain.setValueAtTime(1,t),this.sampler=this.AN.sampler=e.ctx.createBufferSource(),this.sampler.buffer=this.buffer,this.sampler.connect(this.gainer),this.sampler.start?this.sampler.start(t):this.sampler.noteOn(t),void this.fire("pulse")):!1},s.updateLocation=function(){this.pulseLocation=this.location,this.period=this.periodSteps[this.periodSteps.length-Math.floor(this.periodSteps.length*this.location.x/t.size.width)-1],this.buffer=this.bufferArray[Math.floor(this.bufferArray.length*this.location.y/t.size.height)]},s.stop=function(t){var i=e.ctx.currentTime+.1;this.soup.stop.call(this,t),this.sampler&&(this.sampler.stop?this.sampler.stop(i+.001):this.sampler.noteOff(i+.001))},s.waveGain=function(e){return e&&(this.ct=e),_.max(1-this.timeSincePulse(this.ct)/this.period,0)}}(),function(){var e=this,t=e.Melodicism.BounceNode=e.Melodicism.SamplerNode.extend();t.color={r:100,g:100,b:255},t.lowColor={r:50,g:50,b:155},t.start=function(){this.currentTime=0},t.tick=function(t){if(t-this.currentTime>this.period){var i;this.siblings=e.Melodicism.Nodes.nodes;for(var n=0,o=this.siblings.length;o>n;n++)i=this.siblings[n],i!==this&&i.affects(this,t)&&(this.updateLocation(),this.pulse(t),o=0)}}}(),function(){var e,t=this,i=t.Melodicism.DroneNode=t.Melodicism.Node.extend();i.color={r:200,g:100,b:255},i.lowColor={r:100,g:50,b:155},i.init=function(i){return t.Melodicism.Node.init.call(this,i),this.soup=t.Melodicism.Node,e=this.Audio,this.waveType="area",this.lfoFrequency=.5,this},i.start=function(){var t=e.ctx.currentTime;this.currentTime=0,this.startTime=t,this.gainer.gain.setValueAtTime(.5,t),this.oscillator=e.createOscillator(),this.oscillator.frequency.value=this.frequency*Math.pow(2,this.location.y/700),this.oscillator.connect(this.gainer),this.oscillator.start(t),this.lfo=e.createOscillator(),this.lfo.frequency.value=this.lfoFrequency,this.lfo.connect(this.gainer.gain),this.lfo.start(t)},i.stop=function(e){this.lfo.disconnect(),this.soup.stop.call(this,e),this.oscillator.stop(this.Audio.ctx.currentTime+.2)},i.waveDistance=function(){return this.waveRadius},i.waveGain=function(e){var t=Math.sin((e-this.startTime)*this.lfoFrequency*2*Math.PI);return 0>t&&(t=Math.abs(t)),t},i.tick=function(e){return},i.pulse=function(t){this.gainer.gain.setValueAtTime(0,t);for(var i=0,n=this.envelope.length;n>i;i++)this.gainer.gain.linearRampToValueAtTime(this.envelope[i][0],t+this.envelope[i][1]);this.oscillator=e.createOscillator(),this.oscillator.frequency.value=this.frequency*Math.pow(2,this.location.y/700),this.oscillator.connect(this.gainer),this.oscillator.start(t),this.oscillator.stop(t+this.envelope[i-1][1]),this.currentTime=t}}(),function(){var e=this,t=e.Melodicism.Nodes={},i=null,n=null,o=null;t.active=!1,t.nodes=[],t.init=function(){e.Melodicism.Controller.listen("touch","down",t.touchDown),e.Melodicism.Controller.listen("touch","up",t.touchUp),e.Melodicism.Controller.listen("move","down",t.drag)},t.activate=function(){t.active=!0},t.deactivate=function(){t.active=!1},t.touchDown=function(e){if(t.active)for(var s,a=0,r=t.nodes.length;r>a;a++)s=t.nodes[a],s.contains(e)&&(i=s,i.startDrag(),o=s.location,n=e)},t.touchUp=function(e){i&&(console.log(e),i.endDrag(),i=null)},t.drag=function(e){console.log(e),i&&(i.location={x:o.x+e.x-n.x,y:o.y+e.y-n.y})},t.add=function(e,i){t.nodes.push(e),e.start(i)},t.remove=function(e){t.nodes.splice(t.nodes.indexOf(e),1)},t.removeAll=function(){_.each(t.nodes,function(e){e.destroy()}),t.nodes=[]},t.reset=function(e){t.removeAll(),_.each(e,function(e){t.add(e,0)})}}(),function(){var e=this,t=e.Melodicism.Sounds=_.ob.extend();t.srces=["chord1.wav","chord2.wav","kick.wav"],t.clips=["possibilities.mp3"],t.buffers={},t.bufferArray=[],t.onloads=[],t.init=function(){this.gainer=e.Melodicism.Audio.ctx.createGain(),this.clip=e.Melodicism.Audio.ctx.createBufferSource(),this.clipTimeout=0,this._playing=!1},t.onload=function(e){t.loaded?e():t.onloads.push(e)},t.done=function(){_.each(t.onloads,function(e){e()}),t.onloads=[]},t.bufferFor=function(e){return this.buffers[e]},t.load=function(){this.loadSrces(this.srces,"sounds"),this.loadSrces(this.clips,"clips")},t.loadSrces=function(t,i){var n=this,o=t.length;_.each(t,function(t){var s=new XMLHttpRequest;s.open("GET",i+"/"+t,!0),s.responseType="arraybuffer",n.buffers[t]=null,s.onload=function(){e.Melodicism.Audio.ctx.decodeAudioData(s.response,function(e){n.buffers[t]=e,o--,console.log("Loaded "+t),1>o&&(n.loaded=!0,n.bufferArray=_.toArray(n.buffers),n.done())},function(){})},s.send()})},t.playClip=function(i,n,o,s){var a=e.Melodicism.Audio,r=a.ctx.currentTime,l=this.gainer;this._playing&&this.pauseClip(),e.Melodicism.Controller.setPlayButtonState("pause"),l.gain.value=0,l.connect(e.Melodicism.Audio.ctx.destination),e.Melodicism.Audio.silenceNodes();var c=this.clip=e.Melodicism.Audio.ctx.createBufferSource();c.buffer=this.buffers[i],c.connect(l),c.start?c.start(n,o,s):c.noteOn(n,o,s),this._playing=!0,this.clipTimeout=setTimeout(t.bound("pauseClip"),1e3*s),l.gain.linearRampToValueAtTime(1,r+.4),l.gain.linearRampToValueAtTime(1,r+s-1),l.gain.linearRampToValueAtTime(0,r+s)},t.pauseClip=function(){var t=e.Melodicism.Audio.ctx.currentTime+.2;clearTimeout(this.clipTimeout),this.gainer.gain.linearRampToValueAtTime(0,t),this.clip.stop?this.clip.stop(t):this.clip.noteOff(t),this._playing=!1,e.Melodicism.Controller.setPlayButtonState("play"),e.Melodicism.Audio.soundNodes()}}(),function(){var e=this,t=e.Melodicism.Message=_.ob.extend();t.init=function(){this.active=null,this.messages=[],this.timeout=0,e.Melodicism.Controller.listen("touch","up",t.bound("touchUp"))},t.send=function(e,t,i){var n={text:e,time:t||1e4,callback:i||function(){}};this.messages.push(n),this.active||this.next()},t.next=function(){var e=this.msg=this.messages.shift();if(e){var t=this.active=document.createElement("message");t.innerHTML=e.text,document.body.appendChild(t),this.timeout=setTimeout(this.bound("pop"),e.time)}else this.active=null},t.pop=function(){var e=this.active;if(e){var t=this;e.className="fade",clearTimeout(this.timeout),setTimeout(function(){document.body.removeChild(e),t.msg.callback(),t.next()},200)}},t.touchUp=function(){t.pop()}}(),function(){var e,t=this,i=t.Puzzle=_.ob.extend();i.Config=["1-possibilities","2-possibilities","3-possibilities"],i.Puzzles={},i.ready=!1,i.highlights=[],i.nextPuzzle=null,i.step=0,i.bornAt=0,i.level=0,i.init=function(){return e=t.Canvas,this.step=1,this.bornAt=_.now(),t.Controller.listen("touch","play",this.bound("playClip")),t.Controller.listen("touch","pause",this.bound("pauseClip")),t.Controller.setPlayButtonState("hide"),this},i.solved=function(){return this._solved||(this._solved=!1),this._solved},i.setSolved=function(){this._solved=!0,this.solvedAt=_.now()},i.next=function(){this.ready=!0,setTimeout(t.loadNextPuzzle,2e3)},i.enableControls=function(){t.Nodes.activate()},i.disableControls=function(){t.Nodes.deactivate()},i.playClip=function(){},i.pauseClip=function(){}}.call(Melodicism),function(){var e=this,t="1-possibilities",i=e.Puzzle.Puzzles[t]=e.Puzzle.extend();i.name=t,i.init=function(){return e.Puzzle.init.call(this),Canvas=e.Canvas,this.node1=e.SamplerNode.create({src:["kick.wav"],location:{x:e.Canvas.center.x-10,y:200},periodRange:[.5,2],beatSeconds:.8202,beatSteps:[.5,1,2,4],color:{r:255,g:0,b:0},lowColor:{r:200,g:0,b:0}}),e.Nodes.reset([this.node1]),e.Controller.listen("touch","up",this.bound("touchUp")),e.Message.send("Hi, this is Melodicism.",1e4),e.Message.send("It's a game",1e4),e.Message.send("about music.",1e4,this.bound("enableControls")),e.Message.send("Move the <emph>node</emph> left and right to change its tempo.",1e4,this.bound("moveNode")),this},i.solved=function(){return this._solved||(this._solved=this.ready&&this.node1.period>.8201&&this.node1.period<.8203,this._solved&&(this.solvedAt=_.now())),this._solved},i.touchUp=function(){200!==this.node1.location.y&&2===this.step?this.moveNode2():4===this.step&&this.node1.period>.8201&&this.node1.period<.8203&&this.done()},i.enableControls=function(){e.Nodes.activate()},i.moveNode=function(){this.step=2},i.moveNode2=function(){this.step=3,e.Message.send("Pretty neat, huh?",1e4),e.Message.send("Notice how the beat starts playing at the exact time you drop the node."),e.Message.send("The beat we're going for isn't too fast or too slow.",1e4,this.bound("moveNode3"))},i.moveNode3=function(){this.step=4,e.Message.send("Try moving it here.",1e4),this.highlights=[{x:Canvas.size.width/2,y:0,w:Canvas.size.width/4,h:Canvas.size.height,color:{r:100,g:0,b:0}}]},i.done=function(){this.highlights=[],e.Message.send("Groovy. You got it."),e.Nodes.deactivate(),this.step=5,this.next()}}.call(Melodicism),function(){var e=this,t="2-possibilities",i=e.Puzzle.Puzzles[t]=e.Puzzle.extend();i.name=t,i.init=function(){return e.Puzzle.init.call(this),Canvas=e.Canvas,this.node1=e.SamplerNode.create({src:["chord1.wav","chord2.wav"],location:{x:e.Canvas.center.x-10,y:200},periodRange:[2,6],periodSteps:[2,4,6],color:{r:0,g:255,b:0},lowColor:{r:0,g:100,b:0}}),this.node2=e.BounceNode.create({src:["chord1.wav","chord2.wav"],location:{x:e.Canvas.center.x-10,y:200},periodRange:[2,6],periodSteps:[2,4,6],color:{r:0,g:255,b:0},lowColor:{r:0,g:100,b:0}}),e.Nodes.reset([this.node1]),e.Controller.listen("touch","up",this.bound("touchUp")),e.Message.send("Now let's add some melody.",1e4),e.Message.send("This node can play two chords.",1e4,this.bound("lower")),e.Message.send("Try moving it to the lower region and hear how it changes.",1e4),this},i.lower=function(){e.Nodes.activate(),this.step=2,this.highlights=[{x:0,y:Canvas.center.y,w:Canvas.size.width,h:Canvas.size.height/2,color:{r:0,g:50,b:0}}]},i.solved=function(){return this._solved||(this._solved=this.ready),this._solved},i.touchUp=function(){2===this.step&&this.node1.buffer===this.node1.bufferArray[1]&&this.step3()},i.step3=function(){this.step=3,e.Nodes.deactivate(),this.highlights=[],e.Message.send("Good!"),e.Message.send("It's not the most interesting melody, though."),e.Message.send("We're still only playing one note.",null,this.bound("step4")),e.Message.send("Here's a second node."),e.Message.send("Oops. My bad."),e.Message.send("It looks like it's low on energy.",null,this.bound("enableControls")),e.Message.send("I wonder how we could we can get it some juice...")},i.step4=function(){this.node2.on("pulse",this.step5,this),e.Nodes.add(this.node2)},i.step5=function(){e.Message.send("Nice!"),e.Message.send("I'm guessing we'll see more low-energy nodes in the coming puzzles.",null,this.bound("done")),this.node2.off("pulse",this.step5)},i.done=function(){this.next()}}.call(Melodicism),function(){var e=this,t="3-possibilities",i=e.Puzzle.Puzzles[t]=e.Puzzle.extend();i.name=t,i.init=function(){return e.Puzzle.init.call(this),Canvas=e.Canvas,this.beat=.8202,this.node1=e.SamplerNode.create({src:["chord1.wav","chord2.wav"],location:{x:e.Canvas.center.x-10,y:200},beatSeconds:this.beat,beatSteps:[4,6,8],color:{r:0,g:255,b:0},lowColor:{r:0,g:100,b:0}}),this.node2=e.BounceNode.create({src:["chord1.wav","chord2.wav"],location:{x:e.Canvas.center.x+300,y:200},color:{r:0,g:255,b:0},lowColor:{r:0,g:100,b:0}}),this.kick=e.SamplerNode.create({src:["kick.wav"],location:{x:e.Canvas.center.x-300,y:200},beatSeconds:this.beat,beatSteps:[.5,1,2],color:{r:255,g:0,b:0},lowColor:{r:200,g:0,b:0}}),e.Nodes.reset([]),e.Message.send("Now that you've got the hang of things, let's see if you can construct a song.",1e4),e.Message.send("I'll play it for you first.",null,this.bound("playSong")),this},i.playSong=function(){this.playClip(),setTimeout(this.bound("step2"),11e3)},i.playClip=function(){e.Sounds.playClip("possibilities.mp3",0,23.5,11)},i.pauseClip=function(){e.Sounds.pauseClip()},i.step2=function(){e.Controller.setPlayButtonState("play"),e.Message.send("If you want to hear it again, you can touch the arrow at the top right."),e.Message.send("Anyway, here are the nodes you'll need to complete the song.",null,this.bound("addNodes")),e.Message.send("Good luck!",null,this.bound("enableControls"))},i.addNodes=function(){e.Nodes.reset([this.node1,this.node2,this.kick]),this.node1.on("pulse",this.bound("nodePulsed")),this.node2.on("pulse",this.bound("nodePulsed"))},i.nodePulsed=function(){var e,t;e=Math.abs(this.node1.currentTime-this.node2.currentTime)/this.kick.period,t=Math.abs(this.node1.currentTime-this.kick.startTime)/this.kick.period,t=Math.abs(t-Math.round(t)),console.log(this.kick.period,e,t),this.kick.period>this.beat-.1&&this.kick.period<this.beat+.1&&(e=Math.abs(this.node1.currentTime-this.node2.currentTime)/this.kick.period,e>3.9&&4.1>e&&(t=Math.abs(this.node1.currentTime-this.kick.startTime)/this.kick.period,t=Math.abs(t-Math.round(t)),.25>t&&this.node1.buffer!==this.node2.buffer&&this.done()))},i.done=function(){var t=this;this.disableControls(),e.Message.send("Woooo! You did it!"),t.ready=!0,setTimeout(function(){t.setSolved(),t.next()},5e3)},i.touchUp=function(){2===this.step&&this.node1.buffer===this.node1.bufferArray[1]&&this.step3()},i.step3=function(){this.step=3,e.Nodes.deactivate(),this.highlights=[],e.Message.send("Good!"),e.Message.send("It's not the most interesting melody, though."),e.Message.send("We're still only playing one note.",null,this.bound("step4")),e.Message.send("Here's a second node."),e.Message.send("Oops. My bad."),e.Message.send("It looks like it's low on energy.",null,this.bound("enableControls")),e.Message.send("I wonder how we could we can get it some juice...")},i.step4=function(){this.node2.on("pulse",this.step5,this),e.Nodes.add(this.node2)},i.step5=function(){e.Message.send("Nice!"),e.Message.send("I'm guessing we'll see more low-energy nodes in the coming puzzles.",null,this.bound("done")),this.node2.off("pulse",this.step5)}}.call(Melodicism);